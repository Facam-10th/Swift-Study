# CH07. Closure

## TOC

- some
- contents

## A. Clousure

일정기능을 수행하는 코드를 하나의 블록`{}`으로 모아놓은것을 말함

Swift에서 Closure라고 부르는것들은 다음과 같은 형태중 하나를 취하고 있다.

1. 이름이 있고 어떤 값도 획득하지 않는 전역함수의 형태

```swift
// 어디에도 속하지 않은 함수들을 전역함수라고 부른다.
func globalFuntion() {
    <#code#>
}

class SomeClass { ... }
```


2. 이름이 있고 다른 함수의 값을 획득할 수 있는 중첩함수의 형태

```swift
func outer(base: Int) -> String {
  
  func inner(inc: Int) -> String {
    return "\(inc)를 반환합니다" 
  }
  
  let result = inner(inc: base + 1)
  return result
  
}

outer(base: 3) // 4를 반환합니다
```

3. **클로저 표현식** : 이름이 없고 주변 문맥에 따라 값을 획득할 수 있는 축약문법 형태

```swift
{ (매개변수) -> 반환타입 in

실행 구문

}
```

> 클로저 표현식이란 클로저가 함수의 형태가 아닌 블록`{}`의 모습으로 표현할 수 있는 방법을 의미한다.

**위에 내용들을 보아 함수도 클로저라는것을 알 수 있다.**

## 특징

- 클로저는 매개변수와 반환값의 타입을 문맥을 통해 유추가 가능하기 때문에 타입선언을 생략할 수 있다.

- 클로저 내부에 단 한줄의 표현식만 들어가 있다면 암시적으로 반환값으로 전달한다.

- 축약된 전달인자 이름을 사용할 수 있다.

- 후행 클로저 문법사용이 가능하다.

## Syntax

앞에서 나열한 특징들을 기준으로 클로저 문법에 대해 설명한다.

1. **클로저는 매개변수와 반환값의 타입을 문맥을 통해 유추가 가능하기 때문에 타입선언을 생략할 수 있다.**

```swift
{ () -> () in
    print("매개변수와 반환값이 없는 클로저")
}
```
*매개변수 또는 반환값이 없는경우엔 ()로 표현한다.* 

*클로저 표현식의 모호성을 제거하기위한 Swift의 규칙*

```swift
// 클로저는 일급객체의 특성을 가지고 있어 변수에 할당이 가능하다.
let closure = { (param) in
    param + "!"
}
closure("string")
```

*"string"이라는 문자열이 들어오고 "string!"이라는 문자열이 반환되는것으로 클로저의 매개변수와 반환값을 타입을 유추 한다.*

```swift
// 클로저는 일급객체의 특성을 가지고 있어 변수에 할당이 가능하다.
let closure = { (param: String) -> String in
    return param + "!"
}
closure("string")
```

> 물론 타입지정도 가능하다.

2. **클로저 내부에 단 한줄의 표현식만 들어가 있다면 암시적으로 반환값으로 전달한다.**

```swift
let closure = { (param: String) -> String in
    param + "!"
    // 클로저 내부 표현식이 한줄밖에 없어 암시적으로 반환값으로 지정된다.
}
closure("string")
```

3. **축약된 전달인자 이름을 사용할 수 있다.**

Swift에서 단축인자를 제공하며 $와 숫자의 조합으로 표현할 수 있다.

```swift
let names = ["참솔", "유진", "동현", "지승", "중창", "지현", "수한", "의석", "유경"]

// 단축인자 미사용
names.sorted(by: { (first, second) -> Bool in
    first < second
})

// 단축인자 사용
names.sorted(by: {
    $0 < $1
})
// 결과 : ["동현", "수한", "유경", "유진", "의석", "중창", "지승", "지현", "참솔"] 
```

4. **후행 클로저 문법사용이 가능하다.**

*후행 클로저란 함수의 마지막 인자가 클로저형식일때 인자로써 전달하는 형식이 아니라 바로 클로저를 사용하여 작성하는 방식

```swift
let names = ["참솔", "유진", "동현", "지승", "중창", "지현", "수한", "의석", "유경"]
names.sorted { $0 < $1 }
// 결과 : ["동현", "수한", "유경", "유진", "의석", "중창", "지승", "지현", "참솔"] 
```

> **마지막 인자값이 클로저일때만 가능하며 만일 복수의 인자가 클로저 형식이라 하더라도 마지막 인자만 가능하다.**

## 문법 적용해보기

앞에서 클로저의 문법과 특징을 살펴보았다.
그리고 해당 문법들을 잘 사용하면 코드가 마법처럼 줄어든다.

다음은 [Swift공식문서](https://docs.swift.org/swift-book/LanguageGuide/Closures.html)의 내용을 참고해 클로저를 적용해보았다.

```swift
let names = ["Chris", "Alex", "Ewa", "Barry", "Daniella"]
func backward(_ s1: String, _ s2: String) -> Bool {
    return s1 > s2
}
var reversedNames = names.sorted(by: backward) // ["Ewa", "Daniella", "Chris", "Barry", "Alex"]

// 해당함수를 클로저를 사용해 줄여보자.

// 클로저를 사용하여 인자 전달
reversedNames = names.sorted(by: { (s1: String, s2: String) -> Bool in
    return s1 > s2
})

// 타입생략
reversedNames = names.sorted(by: { s1, s2 in
    return s1 > s2
})

// return 생략
reversedNames = names.sorted(by: { s1, s2 in
    s1 > s2
})

// 단축인자 사용
reversedNames = names.sorted(by: { $0 > $1 })

// 단축인자마저 생략
reversedNames = names.sorted(by: >)

```

## 